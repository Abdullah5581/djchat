{% extends "base.html" %}
{% load sizefy %}
{% block css %}
    .reverse-rounded-pill {
        border-bottom-left-radius: 1.2rem;
        border-bottom-right-radius: 1.2rem;
    }

    .chat-form-hr {
        content: "";
        display: block;
        height: 2px;
        background: #292d34;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
    }
{% endblock css %}

{% block content %}
<aside class="sidebar bg-light">
    <div class="tab-content h-100" role="tablist">
        <!-- Create -->
        <div class="tab-pane fade h-100" id="tab-content-create-chat" role="tabpanel">
            <div class="d-flex flex-column h-100">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="hide-scrollbar">
                        <div class="container py-8">
                            <!-- Title -->
                            <div class="mb-8">
                                <h2 class="fw-bold m-0">Create chat</h2>
                            </div>
                            <!-- Search -->
                            <div class="mb-6">
                                <div class="mb-5">
                                    <form action="#">
                                        <div class="input-group">
                                            <div class="input-group-text">
                                                <div class="icon icon-lg">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                                </div>
                                            </div>
                                            <input type="text" class="form-control form-control-lg ps-0" placeholder="Search messages or users" aria-label="Search for messages or users...">
                                        </div>
                                    </form>
                                </div>

                                <ul class="nav nav-pills nav-justified" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-bs-toggle="pill" href="#create-chat-info" role="tab" aria-controls="create-chat-info" aria-selected="true">
                                            Details
                                        </a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="pill" href="#create-chat-members" role="tab" aria-controls="create-chat-members" aria-selected="true">
                                            People
                                        </a>
                                    </li>
                                </ul>
                            </div>

                            <!-- Tabs content -->
                            <div class="tab-content" role="tablist">
                                <div class="tab-pane fade show active" id="create-chat-info" role="tabpanel">
                                    <div class="card border-0">
                                        <div class="profile">
                                            <div class="profile-img text-primary rounded-top">
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 400 140.74"><defs><style>.cls-2{fill:#fff;opacity:0.1;}</style></defs><g><g><path d="M400,125A1278.49,1278.49,0,0,1,0,125V0H400Z"/><path class="cls-2" d="M361.13,128c.07.83.15,1.65.27,2.46h0Q380.73,128,400,125V87l-1,0a38,38,0,0,0-38,38c0,.86,0,1.71.09,2.55C361.11,127.72,361.12,127.88,361.13,128Z"/><path class="cls-2" d="M12.14,119.53c.07.79.15,1.57.26,2.34v0c.13.84.28,1.66.46,2.48l.07.3c.18.8.39,1.59.62,2.37h0q33.09,4.88,66.36,8,.58-1,1.09-2l.09-.18a36.35,36.35,0,0,0,1.81-4.24l.08-.24q.33-.94.6-1.9l.12-.41a36.26,36.26,0,0,0,.91-4.42c0-.19,0-.37.07-.56q.11-.86.18-1.73c0-.21,0-.42,0-.63,0-.75.08-1.51.08-2.28a36.5,36.5,0,0,0-73,0c0,.83,0,1.64.09,2.45C12.1,119.15,12.12,119.34,12.14,119.53Z"/><circle class="cls-2" cx="94.5" cy="57.5" r="22.5"/><path class="cls-2" d="M276,0a43,43,0,0,0,43,43A43,43,0,0,0,362,0Z"/></g></g></svg>
                                            </div>
                                            <div class="profile-body p-0">
                                                <div class="avatar avatar-lg">
                                                    <span class="avatar-text bg-primary">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                                                    </span>
                                                    <div class="badge badge-lg badge-circle bg-primary border-outline position-absolute bottom-0 end-0">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                                    </div>
                                                    <input id="upload-chat-img" class="d-none" name="avatar" accept="image/*" type="file">
                                                    <label class="stretched-label mb-0" for="upload-chat-img"></label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row gy-6">
                                                <div class="col-12">
                                                    <div class="form-floating">
                                                        <input type="text" name="name" class="form-control" id="floatingInput" placeholder="Enter a chat name">
                                                        <label for="floatingInput">Enter group name</label>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="form-floating">
                                                        <textarea class="form-control" name="description" placeholder="Description" id="floatingTextarea" rows="8" data-autosize="true" style="min-height: 100px;"></textarea>
                                                        <label for="floatingTextarea">What's your purpose?</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center mt-4 px-6">
                                        <small class="text-muted me-auto">Enter chat name and add an optional photo.</small>
                                    </div>
                                </div>
                                <!-- Members -->
                                <div class="tab-pane fade" id="create-chat-members" role="tabpanel">
                                    <nav>
                                        {% for letter in first_letters %}
                                            <div class="my-5">
                                                <small class="text-uppercase text-muted">{{ letter }}</small>
                                            </div>
                                            {% for person in people %}
                                                {% if person.user.username|slice:":1"|upper == letter %}
                                                <div class="card border-0 mt-5">
                                                    <div class="card-body">
                                                        <div class="row align-items-center gx-5">
                                                            <div class="col-auto">
                                                                <div class="avatar">
                                                                    <img class="avatar-img" src="{{ person.avatar.url }}" alt="">
                                                                </div>
                                                            </div>
                                                            <div class="col">
                                                                <h5>{{ person.user.username|title }}</h5>
                                                            </div>
                                                            <div class="col-auto">
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox" name="members" value="{{ person.user.id }}" id="id-member-{{ forloop.counter }}">
                                                                    <label class="form-check-label" for="id-member-{{ forloop.counter }}"></label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <label class="stretched-label" for="id-member-{{ forloop.counter }}"></label>
                                                    </div>
                                                </div>
                                                <!-- Card -->
                                                {% endif %}
                                            {% endfor %}
                                        {% endfor %}
                                    </nav>
                                </div>
                            </div>
                            <!-- Tabs content -->
                        </div>
                        <div class="container mt-n4 mb-8 position-relative">
                            <button class="btn btn-lg btn-primary w-100 d-flex align-items-center" name="create_group" type="submit">
                                Start chat
                                <span class="icon ms-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>
                                </span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Chats -->
        <div class="tab-pane fade h-100 show active" id="tab-content-chats" role="tabpanel">
            <div class="d-flex flex-column h-100 position-relative">
                <div class="hide-scrollbar">

                    <div class="container py-8">
                        <!-- Title -->
                        <div class="mb-8">
                            <h2 class="fw-bold m-0">Chats</h2>
                        </div>

                        <!-- Search -->
                        <div class="mb-6">
                            <form action="#">
                                <div class="input-group">
                                    <div class="input-group-text">
                                        <div class="icon icon-lg">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                        </div>
                                    </div>

                                    <input type="text" class="form-control form-control-lg ps-0" placeholder="Search messages or users" aria-label="Search for messages or users...">
                                </div>
                            </form>
                        </div>

                        <!-- Chats -->
                        <div class="card-list" style="cursor: pointer,">
                            {% for group in groups %}
                                <a href="#" class="card border-0 text-reset group-id-{{ group.id }}" onclick="toggleGroupConversation({{ group.id }})">
                                    <div class="card-body">
                                        <div class="row gx-5">
                                            {% if not group.avatar %}
                                            <div class="col-auto">
                                                <div class="{% if not group.members.all.count == 1 %}avatar-group-trigon avatar-group-trigon-sm{% endif %}">
                                                    {% for member in group.members.all|slice:":3" %}
                                                    {% if group.members.all.count == 1 %}
                                                    <div class="avatar">
                                                        <img class="avatar-img" src="{{ member.profile.avatar.url }}" alt="#">
                                                    </div>
                                                    {% else %}
                                                    <div class="avatar avatar-sm">
                                                        <img class="avatar-img" src="{{ member.profile.avatar.url }}" alt="#">
                                                    </div>
                                                    {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            {% else %}
                                            <div class="col-auto">
                                                <div class="avatar avatar-online">
                                                    <img src="{{ group.avatar.url }}" alt="#" class="avatar-img">
                                                </div>
                                            </div>
                                            {% endif %}
                                            <div class="col">
                                                <div class="d-flex align-items-center mb-3">
                                                    <h5 class="me-auto mb-0 side-group-name-{{ group.id }}">{{ group.name }}</h5>
                                                </div>
                                                <div class="d-flex align-items-center">
                                                    <div class="line-clamp me-auto" data-member-group="{{ group.id }}">
                                                        {{ group.members.all.count }} Member{% if not group.members.all.count == 1 %}s{% endif %} 
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div><!-- .card-body -->
                                </a>
                            {% endfor %}

                            {% for thread in threads %}
                                {% if thread.user1 == request.user.profile %}
                                    <a href="#" class="card border-0 text-reset" onclick="toggleConversation({{ thread.user1.id }}, {{ thread.user2.id }})">
                                        <div class="card-body">
                                            <div class="row gx-5">
                                                <div class="col-auto">
                                                    <div class="avatar avatar-online">
                                                        <img src="{{ thread.user2.avatar.url }}" alt="#" class="avatar-img">
                                                    </div>
                                                </div>

                                                <div class="col">
                                                    <div class="d-flex align-items-center mb-3">
                                                        <h5 class="me-auto mb-0">{{ thread.user2.user.username|title }}</h5>
                                                        {% comment %} <span class="text-muted extra-small ms-2">08:35 PM</span> {% endcomment %}
                                                    </div>

                                                    <div class="d-flex align-items-center">
                                                        {% comment %} <div class="line-clamp me-auto">
                                                            is typing<span class='typing-dots'><span>.</span><span>.</span><span>.</span></span>
                                                        </div> {% endcomment %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                    {% else %}
                                    <a href="#" class="card border-0 text-reset" onclick="toggleConversation({{ thread.user2.id }}, {{ thread.user1.id }})">
                                        <div class="card-body">
                                            <div class="row gx-5">
                                                <div class="col-auto">
                                                    <div class="avatar avatar-online">
                                                        <img src="{{ thread.user1.avatar.url }}" alt="#" class="avatar-img">
                                                    </div>
                                                </div>

                                                <div class="col">
                                                    <div class="d-flex align-items-center mb-3">
                                                        <h5 class="me-auto mb-0">{{ thread.user1.user.username|title }}</h5>
                                                        {% comment %} <span class="text-muted extra-small ms-2">08:35 PM</span> {% endcomment %}
                                                    </div>

                                                    <div class="d-flex align-items-center">
                                                        {% comment %} <div class="line-clamp me-auto">
                                                            is typing<span class='typing-dots'><span>.</span><span>.</span><span>.</span></span>
                                                        </div> {% endcomment %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <!-- Chats -->
                    </div>

                </div>
            </div>
        </div>

        <!-- Settings -->
        <div class="tab-pane fade h-100" id="tab-content-settings" role="tabpanel">
            <div class="d-flex flex-column h-100">
                <div class="hide-scrollbar">
                    <div class="container py-8">
                        <!-- Title -->
                        <div class="mb-8">
                            <h2 class="fw-bold m-0">Settings</h2>
                        </div>

                        <!-- Search -->
                        <div class="mb-6">
                            <form action="#">
                                <div class="input-group">
                                    <div class="input-group-text">
                                        <div class="icon icon-lg">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                        </div>
                                    </div>

                                    <input type="text" class="form-control form-control-lg ps-0" placeholder="Search messages or users" aria-label="Search for messages or users...">
                                </div>
                            </form>
                        </div>

                        <!-- Profile -->
                        <div class="card border-0">
                            <div class="card-body">
                                <form method="POST" enctype="multipart/form-data">
                                    <div class="row align-items-center gx-5">
                                            {% csrf_token %}
                                            <div class="col-auto">
                                                <div class="avatar">
                                                    <img src="{{ request.user.profile.avatar.url }}" alt="#" class="avatar-img">
                                                    <div class="badge badge-circle bg-secondary border-outline position-absolute bottom-0 end-0">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                                                    </div>
                                                    <input id="upload-profile-photo" name="avatar" class="d-none" type="file">
                                                    <label class="stretched-label mb-0" for="upload-profile-photo"></label>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <h5>{{ request.user.username|title }}</h5>
                                                <p>{{ request.user.email }}</p>
                                            </div>
                                            <div class="col-auto">
                                                <button type="submit" class="text-muted" name="change-avatar" style="padding: 0; background-color: transparent; border: none; margin: 0;">
                                                    <div class="icon">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                                    </div>
                                                </button>
                                            </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <!-- Profile -->

                        <!-- Account -->
                        <div class="mt-8">
                            <div class="d-flex align-items-center mb-4 px-6">
                                <small class="text-muted me-auto">Account</small>
                            </div>

                            <div class="card border-0">
                                <div class="card-body py-2">
                                    <!-- Accordion -->
                                    <div class="accordion accordion-flush" id="accordion-profile">
                                        <div class="accordion-item">
                                            <div class="accordion-header" id="accordion-profile-1">
                                                <a href="#" class="accordion-button text-reset collapsed" data-bs-toggle="collapse" data-bs-target="#accordion-profile-body-1" aria-expanded="false" aria-controls="accordion-profile-body-1">
                                                    <div>
                                                        <h5>Profile settings</h5>
                                                        <p>Change your profile settings</p>
                                                    </div>
                                                </a>
                                            </div>

                                            <div id="accordion-profile-body-1" class="accordion-collapse collapse" aria-labelledby="accordion-profile-1" data-parent="#accordion-profile">
                                                <div class="accordion-body">
                                                    <form method="post">
                                                        {% csrf_token %}
                                                        {% if profile_form.non_field_errors %}
                                                            <div class="col-12">
                                                                {% for error in profile_form.non_field_errors %}<small class="error-text">{{ error }}</small>{% endfor %}
                                                            </div>
                                                        {% endif %}
                                                        {% for field in profile_form.visible_fields %}
                                                        <div class="form-floating mb-6">
                                                            {{ field }}
                                                            {{ field.label_tag }}
                                                            {% if field.errors %}
                                                                {% for error in field.errors %}<small class="error-text">{{ error }}</small>{% endfor %}
                                                            {% endif %}
                                                        </div>
                                                        {% endfor %}
                                                        <button type="submit" name="profile-form" class="btn btn-block btn-lg btn-primary w-100">Save</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="accordion-item">
                                            <div class="accordion-header" id="accordion-profile-2">
                                                <a href="#" class="accordion-button text-reset collapsed" data-bs-toggle="collapse" data-bs-target="#accordion-profile-body-2" aria-expanded="false" aria-controls="accordion-profile-body-2">
                                                    <div>
                                                        <h5>Connected accounts</h5>
                                                        <p>Connect with your accounts</p>
                                                    </div>
                                                </a>
                                            </div>

                                            <div id="accordion-profile-body-2" class="accordion-collapse collapse" aria-labelledby="accordion-profile-2" data-parent="#accordion-profile">
                                                <div class="accordion-body">
                                                    <form method="post">
                                                        {% csrf_token %}
                                                        {% if socials_form.non_field_errors %}
                                                            <div class="col-12">
                                                                {% for error in socials_form.non_field_errors %}
                                                                    <small class="error-text">{{ error }}</small>
                                                                {% endfor %}
                                                            </div>
                                                        {% endif %}
                                                        {% for field in socials_form.visible_fields %}
                                                            <div class="form-floating mb-6">
                                                                {{ field }}
                                                                {{ field.label_tag }}
                                                                {% if field.errors %}
                                                                    {% for error in field.errors %}
                                                                        <small class="error-text">{{ error }}</small>
                                                                    {% endfor %}
                                                                {% endif %}
                                                            </div>
                                                        {% endfor %}
                                                        <button type="submit" name="change-password" class="btn btn-block btn-lg btn-primary w-100">Save</button>
                                                    </form>
                                                    
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Switch -->
                                        <div class="accordion-item">
                                            <div class="accordion-header">
                                                <div class="row align-items-center">
                                                    <div class="col">
                                                        <h5>Appearance</h5>
                                                        <p>Choose light or dark theme</p>
                                                    </div>
                                                    <div class="col-auto">
                                                        <a class="switcher-btn text-reset" href="#!" title="Themes">
                                                            <div class="switcher-icon switcher-icon-dark icon icon-lg d-none" data-theme-mode="dark">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                                                            </div>
                                                            <div class="switcher-icon switcher-icon-light icon icon-lg d-none" data-theme-mode="light">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                                                            </div>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Account -->

                        <!-- Security -->
                        <div class="mt-8">
                            <div class="d-flex align-items-center my-4 px-6">
                                <small class="text-muted me-auto">Security</small>
                            </div>

                            <div class="card border-0">
                                <div class="card-body py-2">
                                    <!-- Accordion -->
                                    <div class="accordion accordion-flush" id="accordion-security">
                                        <div class="accordion-item">
                                            <div class="accordion-header" id="accordion-security-1">
                                                <a href="#" class="accordion-button text-reset collapsed" data-bs-toggle="collapse" data-bs-target="#accordion-security-body-1" aria-expanded="false" aria-controls="accordion-security-body-1">
                                                    <div>
                                                        <h5>Password</h5>
                                                        <p>Change your password</p>
                                                    </div>
                                                </a>
                                            </div>

                                            <div id="accordion-security-body-1" class="accordion-collapse collapse" aria-labelledby="accordion-security-1" data-parent="#accordion-security">
                                                <div class="accordion-body">
                                                    <form action="#" autocomplete="on">
                                                        <div class="form-floating mb-6">
                                                            <input type="password" class="form-control" id="profile-current-password" placeholder="Current Password" autocomplete="">
                                                            <label for="profile-current-password">Current Password</label>
                                                        </div>

                                                        <div class="form-floating mb-6">
                                                            <input type="password" class="form-control" id="profile-new-password" placeholder="New password" autocomplete="">
                                                            <label for="profile-new-password">New password</label>
                                                        </div>

                                                        <div class="form-floating mb-6">
                                                            <input type="password" class="form-control" id="profile-verify-password" placeholder="Verify Password" autocomplete="">
                                                            <label for="profile-verify-password">Verify Password</label>
                                                        </div>
                                                    </form>
                                                    <button type="button" class="btn btn-block btn-lg btn-primary w-100">Change Password</button>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Security -->

                    </div>
                </div>
            </div>
        </div>
    </div>
</aside>

<main class="main group-conversation-thread conversation-thread">
    <div class="container h-100">

        <div class="d-flex flex-column h-100 justify-content-center text-center">
            <div class="mb-6">
                <span class="icon icon-xl text-muted">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-square"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                </span>
            </div>
            <p class="text-muted">Pick a person from left menu, <br> and start your conversation.</p>
        </div>
    </div>
</main>


{% for group in groups %}
    <main class="main is-visible group-conversation-thread d-none" data-dropzone-area="" data-sender-id="{{ request.user.id }}" data-group-id="{{ group.id }}" id="group-conversation-thread-{{ group.id }}">
        <div class="container h-100">

            <div class="d-flex flex-column h-100 position-relative">
                <div class="chat-header border-bottom py-4 py-lg-7">
                    <div class="row align-items-center">

                        <!-- Mobile: close -->
                        <div class="col-2 d-xl-none">
                            <a class="icon icon-lg text-muted" href="#" data-toggle-chat="">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg>
                            </a>
                        </div>
                        <!-- Mobile: close -->

                        <!-- Content -->
                        <div class="col-8 col-xl-12">
                            <div class="row align-items-center text-center text-xl-start">
                                <!-- Title -->
                                <div class="col-12 col-xl-6">
                                    <div class="row align-items-center gx-5">
                                        {% if not group.avatar %}
                                            <div class="col-auto">
                                                <div class="{% if not group.members.all.count == 1 %}avatar-group-trigon avatar-group-trigon-sm{% endif %}">
                                                    {% for member in group.members.all|slice:":3" %}
                                                    {% if group.members.all.count == 1 %}
                                                    <div class="avatar" data-bs-toggle="modal" data-bs-target="{% if reques.user == member %}#modal-profile{% else %}#modal-user-profile-{{ member.id }}{% endif %}">
                                                        <img class="avatar-img" src="{{ member.profile.avatar.url }}" alt="#">
                                                    </div>
                                                    {% else %}
                                                    <div class="avatar avatar-sm" data-bs-toggle="modal" data-bs-target="{% if reques.user == member %}#modal-profile{% else %}#modal-user-profile-{{ member.id }}{% endif %}">
                                                        <img class="avatar-img" src="{{ member.profile.avatar.url }}" alt="#">
                                                    </div>
                                                    {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            {% else %}
                                            <div class="col-auto">
                                                <div class="avatar d-none d-xl-inline-block">
                                                    <img class="avatar-img" src="{{ group.avatar.url }}" alt="">
                                                </div>
                                                
                                            </div>
                                            {% endif %}
                                            

                                        <div class="col overflow-hidden group-info">
                                            <h5 class="text-truncate group-name">{{ group.name }}</h5>
                                            <p class="text-truncate group-count">{{ group.members.all.count }} Members</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Title -->

                                <!-- Toolbar -->
                                <div class="col-xl-6 d-none d-xl-block">
                                    <div class="row align-items-center justify-content-end gx-6">
                                        <div class="col-auto">
                                            <a href="#" class="icon icon-lg text-muted" data-bs-toggle="offcanvas" data-bs-target="#offcanvas-more-group-{{ group.id }}" aria-controls="offcanvas-more-group">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
                                            </a>
                                        </div>

                                        <div class="col-auto">
                                            <div class="avatar-group">
                                                {% for member in group.members.all|slice:":3" %}
                                                    <a class="avatar avatar-sm" data-bs-toggle="modal" data-bs-target="#modal-user-profile-{{ member.id }}">
                                                        <img class="avatar-img" src="{{ member.profile.avatar.url }}" alt="#">
                                                    </a>
                                                {% endfor %}
                                                <a href="#" class="avatar avatar-sm" data-bs-toggle="offcanvas" data-bs-target="#offcanvas-add-members-{{ group.id }}" aria-controls="offcanvas-add-members-{{ group.id }}">
                                                    <span class="avatar-text" data-bs-toggle="tooltip" data-bs-placement="bottom" title="" data-bs-original-title="<strong>Add People</strong><p>Invite friends to group</p>">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                                    </span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Toolbar -->
                            </div>
                        </div>
                        <!-- Content -->

                        <!-- Mobile: more -->
                        <div class="col-2 d-xl-none text-end">
                            <div class="dropdown">
                                <a class="text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <div class="icon icon-lg">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                    </div>
                                </a>

                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item" href="#" data-bs-toggle="offcanvas" data-bs-target="#offcanvas-add-members-{{ group.id }}" aria-controls="offcanvas-add-members">Add members</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#" data-bs-toggle="offcanvas" data-bs-target="#offcanvas-more-group-{{ group.id }}" aria-controls="offcanvas-more-group">More</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!-- Mobile: more -->

                    </div>
                </div>
                <!-- Chat: Header -->

                <!-- Chat: Content -->
                <div class="chat-body hide-scrollbar flex-1 h-100">
                    <div class="chat-body-inner {% if not group.group_messages.all %}h-100{% endif %}" style="padding-bottom: 87px">
                        {% if not group.group_messages.all %}
                            <div class="d-flex flex-column h-100 justify-content-center group-chat-empty">
                                <div class="text-center mb-6">
                                    <span class="icon icon-xl text-muted">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send">
                                            <line x1="22" y1="2" x2="11" y2="13"></line>
                                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                        </svg>
                                    </span>
                                </div>
                                <p class="text-center text-muted">No messages yet, <br> start the conversation!</p>
                            </div>
                        {% else %}
                            <div class="py-6 py-lg-12">
                                {% for group_message in group.group_messages.all %}
                                    {% if group_message.content or group_message.file_message.all %}
                                        {% if group_message.sender == request.user.profile %}
                                            <div class="message message-out" data-message-id="{{ group_message.id }}">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#modal-profile" class="avatar avatar-responsive">
                                                    <img class="avatar-img" src="{{ group_message.sender.avatar.url }}" alt="">
                                                </a>

                                                <div class="message-inner">
                                                    <div class="message-body">
                                                        {% if group_message.file_message.all %}
                                                            {% for file in group_message.file_message.all %}
                                                                {% if file.image_path %}
                                                                    <div class="message-content">
                                                                        <div class="message-gallery">
                                                                            {% if group_message.reply %}
                                                                                <blockquote class="blockquote overflow-hidden">
                                                                                    <h6 class="text-reset text-truncate">Reply to</h6>
                                                                                    <p class="small text-truncate">{% for file in group_message.reply.file_message.all %}{{ file.name }}{% endfor %}</p>
                                                                                </blockquote>
                                                                            {% endif %}
                                                                            <div class="row gx-3">
                                                                                <div class="col">
                                                                                    <img class="img-fluid rounded" src="{{ file.image_path.url }}" data-action="zoom" alt="">
                                                                                    <input type="hidden" class="image-{{ group_message.id }}" value="{{ file.name }}">
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!-- Dropdown -->
                                                                        <div class="message-action">
                                                                            <div class="dropdown">
                                                                                <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                                </a>

                                                                                <ul class="dropdown-menu">
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center group-reply-btn" href="#">
                                                                                            <span class="me-auto">Reply</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                    <li>
                                                                                        <hr class="dropdown-divider">
                                                                                    </li>
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center text-danger group-delete-btn" href="#">
                                                                                            <span class="me-auto">Delete</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% elif file.file_path %}
                                                                    <div class="message-content">
                                                                        <div class="message-text">
                                                                            {% if group_message.reply %}
                                                                                <blockquote class="blockquote overflow-hidden">
                                                                                    <h6 class="text-reset text-truncate">Reply to</h6>
                                                                                    <p class="small text-truncate">{% for file in group_message.reply.file_message.all %}{{ file.name }}{% endfor %}</p>
                                                                                </blockquote>
                                                                            {% endif %}
                                                                            <div class="row align-items-center gx-4">
                                                                                <div class="col-auto">
                                                                                    <a href="{{ file.file_path.url }}" class="avatar avatar-sm">
                                                                                        <div class="avatar-text bg-white text-primary">
                                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                                                                                        </div> 
                                                                                    </a>
                                                                                </div>
                                                                                <div class="col overflow-hidden">
                                                                                    <h6 class="text-truncate text-reset">
                                                                                        <a href="{{ file.file_path.url }}" class="text-reset">{{ file.name }}</a>
                                                                                        <input type="hidden" class="file-{{ group_message.id }}" value="{{ file.name }}">
                                                                                    </h6>
                                                                                    <ul class="list-inline text-uppercase extra-small opacity-75 mb-0">
                                                                                        <li class="list-inline-item">{{ file.file_path.size|sizefy }}</li>
                                                                                    </ul>
                                                                                </div>
                                                                            </div>
                    
                                                                        </div>
                    
                                                                        <!-- Dropdown -->
                                                                        <div class="message-action">
                                                                            <div class="dropdown">
                                                                                <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                                </a>
        
                                                                                <ul class="dropdown-menu">
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center group-reply-btn" href="#">
                                                                                            <span class="me-auto">Reply</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                    <li>
                                                                                        <hr class="dropdown-divider">
                                                                                    </li>
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center text-danger group-delete-btn" href="#">
                                                                                            <span class="me-auto">Delete</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% endif %}
                                                            {% endfor %}
                                                        {% endif %}
                                                        {% if group_message.content %}
                                                            <div class="message-content">
                                                                <div class="message-text">
                                                                    {% if group_message.reply %}
                                                                    <blockquote class="blockquote overflow-hidden">
                                                                        <h6 class="text-reset text-truncate">Reply to</h6>
                                                                        
                                                                        {% if group_message.reply.content %}
                                                                            <p class="small text-truncate">{{ group_message.reply.content }}</p>
                                                                        {% else %}
                                                                            <p class="small text-truncate">{% for file in group_message.reply.file_message.all %}{{ file.name }}{% endfor %}</p>
                                                                        {% endif %}

                                                                    </blockquote>
                                                                    {% endif %}
                                                                    <pre style="font-family: var(--bs-body-font-family);font-size: 15px;font-weight: 400;margin-bottom: 0px;"><p class="direct-message-content">{{ user_message.content }}</p></pre>
                                                                </div>

                                                                <!-- Dropdown -->
                                                                 {% if not file.image_path or file.file_path %}
                                                                <div class="message-action">
                                                                    <div class="dropdown">
                                                                        <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                        </a>

                                                                        <ul class="dropdown-menu">
                                                                            <li>
                                                                                <a class="dropdown-item d-flex align-items-center group-edit-btn" href="#">
                                                                                    <span class="me-auto">Edit</span>
                                                                                    <div class="icon">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-3"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                                                                                    </div>
                                                                                </a>
                                                                            </li>
                                                                            <li>
                                                                                <a class="dropdown-item d-flex align-items-center group-reply-btn" href="#">
                                                                                    <span class="me-auto">Reply</span>
                                                                                    <div class="icon">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                    </div>
                                                                                </a>
                                                                            </li>
                                                                            <li>
                                                                                <hr class="dropdown-divider">
                                                                            </li>
                                                                            <li>
                                                                                <a class="dropdown-item d-flex align-items-center text-danger group-delete-btn" href="#">
                                                                                    <span class="me-auto">Delete</span>
                                                                                    <div class="icon">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                                                    </div>
                                                                                </a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                                {% endif %}
                                                            </div>
                                                        {% endif %}
                                                    </div>

                                                    <div class="message-footer">
                                                        <span class="extra-small text-muted">{{ group_message.timestamp|date:"h:i A" |date:"h:i A" }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        {% else %}
                                            <div class="message" data-message-id="{{ group_message.id }}">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#modal-user-profile-{{ thread.user2.id }}" class="avatar avatar-responsive">
                                                    <img class="avatar-img" src="{{ group_message.sender.avatar.url }}" alt="">
                                                </a>

                                                <div class="message-inner">
                                                    <div class="message-body">
                                                        {% if group_message.file_message.all %}
                                                            {% for file in group_message.file_message.all %}
                                                                {% if file.image_path %}
                                                                    <div class="message-content">
                                                                        {% if user_message.reply %}
                                                                            <blockquote class="blockquote overflow-hidden">
                                                                                <h6 class="text-reset text-truncate">Reply to</h6>
                                                                                <p class="small text-truncate">{% for file in user_message.reply.file_message.all %}{{ file.name }}{% endfor %}</p>
                                                                            </blockquote>
                                                                        {% endif %}
                                                                        <div class="message-gallery">
                                                                            <div class="row gx-3">
                                                                                <div class="col">
                                                                                    <img class="img-fluid rounded" src="{{ file.image_path.url }}" data-action="zoom" alt="">
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!-- Dropdown -->
                                                                        <div class="message-action">
                                                                            <div class="dropdown">
                                                                                <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                                </a>

                                                                                <ul class="dropdown-menu">
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center group-reply-btn" href="#">
                                                                                            <span class="me-auto">Reply</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                    <li>
                                                                                        <hr class="dropdown-divider">
                                                                                    </li>
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center text-danger group-delete-btn" href="#">
                                                                                            <span class="me-auto">Delete</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% elif file.file_path %}
                                                                    <div class="message-content">
                                                                        <div class="message-text">
                                                                            {% if user_message.reply %}
                                                                                <blockquote class="blockquote overflow-hidden">
                                                                                    <h6 class="text-reset text-truncate">Reply to</h6>
                                                                                    <p class="small text-truncate">{% for file in user_message.reply.file_message.all %}{{ file.name }}{% endfor %}</p>
                                                                                </blockquote>
                                                                            {% endif %}
                                                                            <div class="row align-items-center gx-4">
                                                                                <div class="col-auto">
                                                                                    <a href="{{ file.file_path.url }}" class="avatar avatar-sm">
                                                                                        <div class="avatar-text bg-white text-primary">
                                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                                                                                        </div>
                                                                                    </a>
                                                                                </div>
                                                                                <div class="col overflow-hidden">
                                                                                    <h6 class="text-truncate text-reset">
                                                                                        <a href="{{ file.file_path.url }}" class="text-reset">{{ file.name }}</a>
                                                                                    </h6>
                                                                                    <ul class="list-inline text-uppercase extra-small opacity-75 mb-0">
                                                                                        <li class="list-inline-item">{{ file.file_path.size|sizefy }}</li>
                                                                                    </ul>
                                                                                </div>
                                                                            </div>
                    
                                                                        </div>
                    
                                                                        <!-- Dropdown -->
                                                                        <div class="message-action">
                                                                            <div class="dropdown">
                                                                                <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                                </a>

                                                                                <ul class="dropdown-menu">
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center group-reply-btn" href="#">
                                                                                            <span class="me-auto">Reply</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                    <li>
                                                                                        <hr class="dropdown-divider">
                                                                                    </li>
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center text-danger group-delete-btn" href="#">
                                                                                            <span class="me-auto">Delete</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% endif %}
                                                            {% endfor %}
                                                        {% endif %}
                                                        {% if group_message.content %}
                                                            <div class="message-content">
                                                                <div class="message-text">
                                                                    {% if group_message.reply %}
                                                                    <blockquote class="blockquote overflow-hidden">
                                                                        <h6 class="text-reset text-truncate">Reply to</h6>
                                                                        <p class="small text-truncate">{{ group_message.reply.content }}</p>
                                                                    </blockquote>
                                                                    {% endif %}
                                                                    <pre style="font-family: var(--bs-body-font-family);font-size: 15px;font-weight: 400;margin-bottom: 0px;"><p class="group-message-content">{{ user_message.content }}</p></pre>
                                                                </div>

                                                                <!-- Dropdown -->
                                                                <div class="message-action">
                                                                    <div class="dropdown">
                                                                        <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                        </a>
                                                                        <ul class="dropdown-menu" style="">
                                                                            <li>
                                                                                <a class="dropdown-item d-flex group-reply-btn align-items-center" href="#">
                                                                                    <span class="me-auto">Reply</span>
                                                                                    <div class="icon">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                    </div>
                                                                                </a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    </div>

                                                    <div class="message-footer">
                                                        <span class="extra-small text-muted">{{ group_message.timestamp|date:"h:i A" |date:"h:i A" }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                <!-- Chat: Content -->

                <!-- Chat: Footer -->
                <div class="chat-footer pb-3 pb-lg-7 position-absolute bottom-0 start-0">
                    <!-- Chat: Files -->
                    <div class="dz-preview bg-dark" id="dz-preview-row" data-horizontal-scroll="">
                    </div>
                    <!-- Chat: Files -->
    
                    <!-- Chat: Form -->
                    <div class="chat-form reverse-rounded-pill bg-dark" data-sender-id="{{ request.user.id }}" data-emoji-form="">
                        <div class="chat-form-hr"></div>
                        <div class="row align-items-center gx-0">
                            <div class="col-auto">
                                <a href="#" class="btn btn-icon btn-link text-body rounded-circle" id="dz-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-paperclip"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                                </a>
                                <form method="POST" id="group-upload-form" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <input type="hidden" class="group_id" value="{{ group.id }}">
                                    <input multiple=True type="file" class="up-hidden-input" tabindex="-1" style="visibility: hidden; position: absolute; top: 0px; left: 0px; height: 0px; width: 0px;">
                                </form>
                            </div>
    
                            <div class="col">
                                <div class="input-group">
                                    <textarea class="form-control px-0 chat_message" placeholder="Type your message..." rows="1" data-emoji-input="" data-autosize="true"></textarea>
    
                                    <a href="#" class="input-group-text text-body pe-0" data-emoji-btn="">
                                        <span class="icon icon-lg">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-smile"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
                                        </span>
                                    </a>
                                </div>
                            </div>
    
                            <div class="col-auto">
                                <button class="btn btn-icon btn-primary rounded-circle ms-5 group-send-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Chat: Form -->
                </div>
                <!-- Chat: Footer -->
            </div>

        </div>
    </main>

    <div class="offcanvas offcanvas-end offcanvas-aside offcanvas-more-info" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvas-more-group-{{ group.id }}" aria-hidden="true" style="visibility: hidden;">
        <!-- Offcanvas Header -->
        <div class="offcanvas-header py-4 py-lg-7 border-bottom">
            <a class="icon icon-lg text-muted" href="#" data-bs-dismiss="offcanvas">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg>
            </a>

            <div class="visibility-xl-invisible overflow-hidden text-center">
                <h5 class="text-truncate">{{ group.name }}</h5>
                <p class="text-truncate">{{ group.members.all.count }} members</p>
            </div>

            <!-- Dropdown -->
            <div class="dropdown">
                <a class="icon icon-lg text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                </a>

                <ul class="dropdown-menu" style="">
                    {% if group.owner == request.user.profile %}
                    <li>
                        <a href="#" class="dropdown-item d-flex align-items-center text-danger delete-group">
                            Delete
                            <div class="icon ms-auto">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                            </div>
                        </a>
                    </li>
                    {% else %}
                    <li>
                        <a href="#" class="dropdown-item d-flex align-items-center text-danger leave-group">
                            Leave
                            <div class="icon ms-auto">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                            </div>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
        <!-- Offcanvas Header -->

        <!-- Offcanvas Body -->
        <div class="offcanvas-body hide-scrollbar">
            <!-- Avatar -->
            <div class="text-center py-10">
                <div class="row gy-6">
                    {% if group.avatar %}
                    <div class="col-12">
                        <div class="avatar avatar-xl mx-auto">
                            <img src="{{ group.avatar.url }}" alt="#" class="avatar-img">
                        </div>
                    </div>
                    {% else %}
                    <div class="col-auto mx-auto">
                        <div class="{% if not group.members.all.count == 1 %}avatar-group-trigon avatar-group-trigon-sm{% endif %}">
                            {% for member in group.members.all|slice:":3" %}
                            {% if group.members.all.count == 1 %}
                            <div class="avatar">
                                <img class="avatar-img" src="{{ member.profile.avatar.url }}" alt="#">
                            </div>
                            {% else %}
                            <div class="avatar avatar-sm">
                                <img class="avatar-img" src="{{ member.profile.avatar.url }}" alt="#">
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    <div class="col-12">
                        <h4>{{ group.name }}</h4>
                        <p>{{ group.description }}</p>
                    </div>
                </div>
            </div>
            <!-- Avatar -->

            <!-- Tabs -->
            <ul class="nav nav-pills nav-justified" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="pill" href="#offcanvas-group-tab-members" role="tab" aria-controls="offcanvas-group-tab-members" aria-selected="true">
                        People
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="pill" href="#offcanvas-group-tab-media" role="tab" aria-controls="offcanvas-group-tab-media" aria-selected="false">
                        Media
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="pill" href="#offcanvas-group-tab-files" role="tab" aria-controls="offcanvas-group-tab-files" aria-selected="false">
                        Files
                    </a>
                </li>
            </ul>
            <!-- Tabs -->

            <!-- Tabs: Content -->
            <div class="tab-content py-2" role="tablist">
                <!-- Members -->
                <div class="tab-pane fade active show" id="offcanvas-group-tab-members" role="tabpanel">
                    <ul class="list-group list-group-flush">
                        {% for member in group.members.all %}
                            {% if member == group.owner.user %}
                                <li class="list-group-item">
                                    <div class="row align-items-center gx-5">
                                        <!-- Avatar -->
                                        <div class="col-auto">
                                            <a href="#" class="avatar avatar-online">
                                                <img class="avatar-img" src="{{ member.profile.avatar.url }}" alt="">
                                            </a>
                                        </div>
                                        <!-- Avatar -->

                                        <!-- Text -->
                                        <div class="col">
                                            <h5><a href="#">{{ member.username|title }}</a></h5>
                                        </div>
                                        <!-- Text -->

                                        <!-- Owner -->
                                        <div class="col-auto">
                                            <span class="extra-small text-primary">owner</span>
                                        </div>
                                        <!-- Owner -->
                                    </div>
                                </li>
                            {% else %}
                                <li class="list-group-item" id="offcanvas-member-{{ group.id }}-{{ member.id }}">
                                    <div class="row align-items-center gx-5">
                                        <!-- Avatar -->
                                        <div class="col-auto">
                                            <a href="#" class="avatar avatar-online">
                                                <img class="avatar-img" src="{{ member.profile.avatar.url }}" alt="">
                                            </a>
                                        </div>
                                        <!-- Avatar -->

                                        <!-- Text -->
                                        <div class="col">
                                            <h5><a href="#">{{ member.username|title }}</a></h5>
                                        </div>
                                        <!-- Text -->

                                        <!-- Owner -->
                                        <!-- Owner -->

                                        <!-- Dropdown -->
                                        <div class="col-auto">
                                            <div class="dropdown">
                                                <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                </a>

                                                <ul class="dropdown-menu">
                                                    <li>
                                                        <a class="dropdown-item d-flex align-items-center kick-member" data-member-id="{{ member.id }}" href="#">
                                                            Kick
                                                            <div class="icon ms-auto">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trending-up"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                                                            </div>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a class="dropdown-item d-flex align-items-center mute-member" data-member-id="{{ member.id }}" href="#">
                                                            Mute
                                                            <div class="icon ms-auto">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trending-down"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline><polyline points="17 18 23 18 23 12"></polyline></svg>
                                                            </div>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <!-- Dropdown -->
                                    </div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
                <!-- Members -->

                <!-- Media -->
                <div class="tab-pane fade" id="offcanvas-group-tab-media" role="tabpanel">
                    <div class="row row-cols-3 g-3 py-6">
                        {% for group_message in group.group_messages.all %}
                            {% for image in group_message.file_message.all %}
                                {% if image.image_path %}
                                    <div class="col">
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#modal-media-preview-{{ image.id }}" data-theme-img-url="{{ image.image_path.url }}">
                                            <img class="img-fluid rounded" src="{{ image.image_path.url }}" alt="">
                                        </a>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                        
                    </div>
                </div>
                <!-- Media -->

                <!-- Files -->
                <div class="tab-pane fade" id="offcanvas-group-tab-files" role="tabpanel">
                    <ul class="list-group list-group-flush">
                        {% for group_message in group.group_messages.all %}
                            {% for file in group_message.file_message.all %}
                                {% if file.file_path %}
                                    <!-- Item -->
                                    <li class="list-group-item">
                                        <div class="row align-items-center gx-5">
                                            <!-- Icons -->
                                            <div class="col-auto">
                                                <div class="avatar-group">
                                                    <a href="#" class="avatar avatar-sm">
                                                        <img src="{{ group_message.sender.avatar.url }}" class="avatar-img" alt="#">
                                                    </a>

                                                    <a href="#" class="avatar avatar-sm">
                                                        <span class="avatar-text bg-primary">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                                        </span>
                                                    </a>
                                                </div>
                                            </div>
                                            <!-- Icons -->

                                            <!-- Text -->
                                            <div class="col overflow-hidden">
                                                <h5 class="text-truncate">
                                                    <a href="#">{{ file.name }}</a>
                                                </h5>
                                            </div>
                                            <!-- Text -->

                                            <!-- Dropdown -->
                                            <div class="col-auto">
                                                <div class="dropdown">
                                                    <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                    </a>

                                                    <ul class="dropdown-menu">
                                                        <li>
                                                            <a class="dropdown-item d-flex align-items-center" href="{{ file.file_path.url }}">
                                                                Download
                                                                <div class="icon ms-auto">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                                                </div>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <!-- Dropdown -->
                                        </div>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </ul>
                </div>
                <!-- Files -->
            </div>
            <!-- Tabs: Content -->
        </div>
        <!-- Offcanvas Body -->
    </div>

    <div class="offcanvas offcanvas-end offcanvas-aside offcanvas-more-info" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvas-add-members-{{ group.id }}" aria-hidden="true" style="visibility: hidden;">
        <!-- Offcanvas Header -->
        <div class="offcanvas-header py-4 py-lg-7 border-bottom ">
            <a class="icon icon-lg text-muted" href="#" data-bs-dismiss="offcanvas">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg>
            </a>

            <div class="visibility-xl-invisible overflow-hidden text-center">
                <h5 class="text-truncate">Members</h5>
                <p class="text-truncate">Add new members</p>
            </div>
        </div>
        <!-- Offcanvas Header -->
        <form method="POST">
            {% csrf_token %}
            <!-- Offcanvas Body -->
            <div class="offcanvas-body hide-scrollbar py-0">

                <!-- Members -->
                <ul class="list-group list-group-flush">
                    {% for letter in first_letters %}
                        <li class="list-group-item">
                            <small class="text-uppercase text-muted">{{ letter }}</small>
                        </li>

                        {% for person in people %}
                            {% if person.user.username|slice:":1"|upper == letter %}
                            <li class="list-group-item">
                                <div class="row align-items-center gx-5">
                                    <div class="col-auto">
                                        <div class="avatar">
                                            <img class="avatar-img" src="{{ person.avatar.url }}" alt="">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <h5>{{ person.user.username|title }}</h5>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-check">
                                            <input type="hidden" value="{{ group.id }}" name="group_id">
                                            <input class="form-check-input" type="checkbox" value="{{ person.user.id }}" name="selected_users" id="id-add-user-user-{{ person.id }}">
                                            <label class="form-check-label" for="id-add-user-user-{{ person.id }}"></label>
                                        </div>
                                    </div>
                                </div>
                                <label class="stretched-label" for="id-add-user-user-{{ person.id }}"></label>
                            </li>
                            <!-- Card -->
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                </ul>
                <!-- Members -->
            </div>
            <!-- Offcanvas Body -->
            <!-- Offcanvas Footer -->
            <div class="offcanvas-footer border-top py-4 py-lg-7">
                <button class="btn btn-lg btn-primary w-100 d-flex align-items-center" name="add_member_submit" type="submit">
                    Add members
                    <span class="icon ms-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </span>
                </button>
            </div>
            <!-- Offcanvas Footer -->
        </form>
    </div>

        
    {% for group_message in group.group_messages.all %}
        {% for image in group_message.file_message.all %}
            {% if image.image_path %}
                <div class="modal fade" id="modal-media-preview-{{ image.id }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-xl modal-dialog-centered modal-fullscreen-xl-down">
                        <div class="modal-content">

                            <!-- Modal: Header -->
                            <div class="modal-header">
                                <button type="button" class="btn-close btn-close-arrow" data-bs-dismiss="modal" aria-label="Close"></button>

                                <div>
                                    <!-- Dropdown -->
                                    <div class="dropdown">
                                        <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                        </a>

                                        <ul class="dropdown-menu">
                                            <li>
                                                <a class="dropdown-item d-flex align-items-center" href="{{ image.image_path.url }}">
                                                    Download
                                                    <div class="icon ms-auto">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download-cloud"><polyline points="8 17 12 21 16 17"></polyline><line x1="12" y1="12" x2="12" y2="21"></line><path d="M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29"></path></svg>
                                                    </div>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <!-- Dropdown -->
                                </div>
                            </div>
                            <!-- Modal: Header -->

                            <!-- Modal: Body -->
                            <div  class="modal-body p-0">
                                <div class="d-flex align-items-center justify-content-center h-100">
                                    <img class="img-fluid modal-preview-url" src="{{ image.image_path.url }}" alt="#">
                                </div>
                            </div>
                            <!-- Modal: Body -->

                            <!-- Modal: Footer -->
                            <div class="modal-footer">
                                <div class="w-100 text-center">
                                    <h6><a href="#">{{ group_message.sender|title }}</a></h6>
                                    <p class="small">Today at {{ group_message.timestamp|date:"h:i A"  }}</p>
                                </div>
                            </div>
                            <!-- Modal: Footer -->
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    {% endfor %}

{% endfor %}

{% for thread in threads %}
    <div class="main conversation-thread d-none" data-dropzone-area="" data-sender-id="{{ request.user.id }}" data-thread-id="{{ thread.id }}" data-receiver-id="{% if thread.user1 == request.user.profile %}{{ thread.user2.id }}{% else %}{{ thread.user1.id }}{% endif %}" id="conversation-{% if thread.user1 == request.user.profile %}{{ thread.user2.id }}{% else %}{{ thread.user1.id }}{% endif %}">
        <div class="container h-100">
            <div class="d-flex flex-column h-100 position-relative">
                <!-- Chat: Header -->
                <div class="chat-header border-bottom py-4 py-lg-7">
                    <div class="row align-items-center">

                        <!-- Mobile: close -->
                        <div class="col-2 d-xl-none">
                            <a class="icon icon-lg text-muted" href="#" data-toggle-chat="">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg>
                            </a>
                        </div>
                        <!-- Mobile: close -->
                        <!-- Content -->
                        <div class="col-8 col-xl-12">
                            <div class="row align-items-center text-center text-xl-start">
                                {% if thread.user1 == request.user.profile %}
                                <!-- Title -->
                                <div class="col-12 col-xl-6">
                                    <div class="row align-items-center gx-5">
                                        <div class="col-auto">
                                            <div class="avatar d-none d-xl-inline-block">
                                                <img class="avatar-img" src="{{ thread.user2.avatar.url }}" alt="">
                                            </div>
                                        </div>

                                        <div class="col overflow-hidden">
                                            <h5 class="text-truncate">{{ thread.user2.user.username|title }}</h5>
                                        </div>
                                    </div>
                                </div>
                                <!-- Title -->

                                <!-- Toolbar -->
                                <div class="col-xl-6 d-none d-xl-block">
                                    <div class="row align-items-center justify-content-end gx-6">
                                        <div class="col-auto">
                                            <a href="#" class="icon icon-lg text-muted" data-bs-toggle="offcanvas" data-bs-target="#offcanvas-more-{{ thread.id }}" aria-controls="offcanvas-more">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
                                            </a>
                                        </div>

                                        <div class="col-auto">
                                            <div class="avatar-group">
                                                <a href="#" class="avatar avatar-sm" data-bs-toggle="modal" data-bs-target="#modal-profile">
                                                    <img class="avatar-img" src="{{ thread.user1.avatar.url }}" alt="#">
                                                </a>

                                                <a href="#" class="avatar avatar-sm" data-bs-toggle="modal" data-bs-target="#modal-user-profile-{{ thread.user2.id }}">
                                                    <img class="avatar-img" src="{{ thread.user2.avatar.url }}" alt="#">
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Toolbar -->
                                {% else %}
                                <!-- Title -->
                                <div class="col-12 col-xl-6">
                                    <div class="row align-items-center gx-5">
                                        <div class="col-auto">
                                            <div class="avatar d-none d-xl-inline-block">
                                                <img class="avatar-img" src="{{ thread.user1.avatar.url }}" alt="">
                                            </div>
                                        </div>

                                        <div class="col overflow-hidden">
                                            <h5 class="text-truncate">{{ thread.user1.user.username|title }}</h5>
                                        </div>
                                    </div>
                                </div>
                                <!-- Title -->

                                <!-- Toolbar -->
                                <div class="col-xl-6 d-none d-xl-block">
                                    <div class="row align-items-center justify-content-end gx-6">
                                        <div class="col-auto">
                                            <a href="#" class="icon icon-lg text-muted" data-offcanvas="info">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
                                            </a>
                                        </div>

                                        <div class="col-auto">
                                            <div class="avatar-group">
                                                <a href="#" class="avatar avatar-sm" data-bs-toggle="modal" data-bs-target="#modal-profile">
                                                    <img class="avatar-img" src="{{ thread.user2.avatar.url }}" alt="#">
                                                </a>

                                                <a href="#" class="avatar avatar-sm" data-bs-toggle="modal" data-bs-target="#modal-user-profile-{{ thread.user2.id }}">
                                                    <img class="avatar-img" src="{{ thread.user1.avatar.url }}" alt="#">
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Toolbar -->
                                {% endif %}
                            </div>
                        </div>
                        <!-- Content -->

                        <!-- Mobile: more -->
                        <div class="col-2 d-xl-none text-end">
                            <a href="#" class="icon icon-lg text-muted" data-offcanvas="info">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                            </a>
                        </div>
                        <!-- Mobile: more -->

                    </div>
                </div>
                <!-- Chat: Header -->

                <!-- Chat: Content -->
                <div class="chat-body hide-scrollbar flex-1 h-100">
                    <div class="chat-body-inner {% if not thread.messages.all %}h-100{% endif %}" style="padding-bottom: 87px">
                        {% if thread.messages.all %}
                            <div class="py-6 py-lg-12">
                                {% for user_message in thread.messages.all %}
                                    {% if not user_message.is_deleted_by_sender %}
                                        {% if user_message.sender == request.user.profile %}
                                            <div class="message message-out" data-message-id="{{ user_message.id }}">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#modal-profile" class="avatar avatar-responsive">
                                                    <img class="avatar-img" src="{{ user_message.sender.avatar.url }}" alt="">
                                                </a>
            
                                                <div class="message-inner">
                                                    <div class="message-body">
                                                        {% if user_message.file_message.all %}
                                                            {% for file in user_message.file_message.all %}
                                                                {% if file.image_path %}
                                                                    <div class="message-content">
                                                                        <div class="message-gallery">
                                                                            {% if user_message.reply %}
                                                                                <blockquote class="blockquote overflow-hidden">
                                                                                    <h6 class="text-reset text-truncate">Reply to</h6>
                                                                                    <p class="small text-truncate">{% for file in user_message.reply.file_message.all %}{{ file.name }}{% endfor %}</p>
                                                                                </blockquote>
                                                                            {% endif %}
                                                                            <div class="row gx-3">
                                                                                <div class="col">
                                                                                    <img class="img-fluid rounded" src="{{ file.image_path.url }}" data-action="zoom" alt="">
                                                                                    <input type="hidden" class="image-{{ user_message.id }}" value="{{ file.name }}">
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!-- Dropdown -->
                                                                        <div class="message-action">
                                                                            <div class="dropdown">
                                                                                <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                                </a>

                                                                                <ul class="dropdown-menu">
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center direct-reply-btn" href="#">
                                                                                            <span class="me-auto">Reply</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                    <li>
                                                                                        <hr class="dropdown-divider">
                                                                                    </li>
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center text-danger direct-delete-btn" href="#">
                                                                                            <span class="me-auto">Delete</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% elif file.file_path %}
                                                                    <div class="message-content">
                                                                        <div class="message-text">
                                                                            {% if user_message.reply %}
                                                                                <blockquote class="blockquote overflow-hidden">
                                                                                    <h6 class="text-reset text-truncate">Reply to</h6>
                                                                                    <p class="small text-truncate">{% for file in user_message.reply.file_message.all %}{{ file.name }}{% endfor %}</p>
                                                                                </blockquote>
                                                                            {% endif %}
                                                                            <div class="row align-items-center gx-4">
                                                                                <div class="col-auto">
                                                                                    <a href="{{ file.file_path.url }}" class="avatar avatar-sm">
                                                                                        <div class="avatar-text bg-white text-primary">
                                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                                                                                        </div> 
                                                                                    </a>
                                                                                </div>
                                                                                <div class="col overflow-hidden">
                                                                                    <h6 class="text-truncate text-reset">
                                                                                        <a href="{{ file.file_path.url }}" class="text-reset">{{ file.name }}</a>
                                                                                        <input type="hidden" class="file-{{ user_message.id }}" value="{{ file.name }}">
                                                                                    </h6>
                                                                                    <ul class="list-inline text-uppercase extra-small opacity-75 mb-0">
                                                                                        <li class="list-inline-item">{{ file.file_path.size|sizefy }}</li>
                                                                                    </ul>
                                                                                </div>
                                                                            </div>
                    
                                                                        </div>
                    
                                                                        <!-- Dropdown -->
                                                                        <div class="message-action">
                                                                            <div class="dropdown">
                                                                                <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                                </a>

                                                                                <ul class="dropdown-menu">
                                                                                    <li>
                                                                                        <hr class="dropdown-divider">
                                                                                    </li>
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center text-danger direct-delete-btn" href="#">
                                                                                            <span class="me-auto">Delete</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% endif %}
                                                            {% endfor %}
                                                        {% endif %}
                                                        {% if user_message.content %}
                                                            <div class="message-content">
                                                                <div class="message-text">
                                                                    {% if user_message.reply %}
                                                                    <blockquote class="blockquote overflow-hidden">
                                                                        <h6 class="text-reset text-truncate">Reply to</h6>
                                                                        <p class="small text-truncate">{{ user_message.reply.content }}</p>
                                                                    </blockquote>
                                                                    {% endif %}
                                                                    <pre style="font-family: var(--bs-body-font-family);font-size: 15px;font-weight: 400;margin-bottom: 0px;"><p class="direct-message-content">{{ user_message.content }}</p></pre>
                                                                </div>

                                                                <!-- Dropdown -->
                                                                {% if not file.image_path or file.file_path %}
                                                                    <div class="message-action">
                                                                        <div class="dropdown">
                                                                            <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                            </a>

                                                                            <ul class="dropdown-menu">
                                                                                <li>
                                                                                    <a class="dropdown-item d-flex align-items-center direct-edit-btn" href="#">
                                                                                        <span class="me-auto">Edit</span>
                                                                                        <div class="icon">
                                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-3"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                                                                                        </div>
                                                                                    </a>
                                                                                </li>
                                                                                <li>
                                                                                    <a class="dropdown-item d-flex align-items-center direct-reply-btn" href="#">
                                                                                        <span class="me-auto">Reply</span>
                                                                                        <div class="icon">
                                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                        </div>
                                                                                    </a>
                                                                                </li>
                                                                                <li>
                                                                                    <hr class="dropdown-divider">
                                                                                </li>
                                                                                <li>
                                                                                    <a class="dropdown-item d-flex align-items-center text-danger direct-delete-btn" href="#">
                                                                                        <span class="me-auto">Delete</span>
                                                                                        <div class="icon">
                                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                                                        </div>
                                                                                    </a>
                                                                                </li>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                {% endif %}
                                                            </div>
                                                        {% endif %}
                                                    </div>
            
                                                    <div class="message-footer">
                                                        <span class="extra-small text-muted">{{ user_message.timestamp|date:"h:i A" }} </span>
                                                    </div>
                                                </div>
                                            </div>
                                        {% else %}
                                            <div class="message" data-message-id="{{ user_message.id }}">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#modal-user-profile-{{ thread.user2.id }}" class="avatar avatar-responsive">
                                                    <img class="avatar-img" src="{{ user_message.sender.avatar.url }}" alt="">
                                                </a>

                                                <div class="message-inner">
                                                    <div class="message-body">
                                                        {% if user_message.file_message.all %}
                                                            {% for file in user_message.file_message.all %}
                                                                {% if file.image_path %}
                                                                    <div class="message-content">
                                                                        {% if user_message.reply %}
                                                                            <blockquote class="blockquote overflow-hidden">
                                                                                <h6 class="text-reset text-truncate">Reply to</h6>
                                                                                <p class="small text-truncate">{% for file in user_message.reply.file_message.all %}{{ file.name }}{% endfor %}</p>
                                                                            </blockquote>
                                                                        {% endif %}
                                                                        <div class="message-gallery">
                                                                            <div class="row gx-3">
                                                                                <div class="col">
                                                                                    <img class="img-fluid rounded" src="{{ file.image_path.url }}" data-action="zoom" alt="">
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!-- Dropdown -->
                                                                        <div class="message-action">
                                                                            <div class="dropdown">
                                                                                <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                                </a>

                                                                                <ul class="dropdown-menu">
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center direct-reply-btn" href="#">
                                                                                            <span class="me-auto">Reply</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                    <li>
                                                                                        <hr class="dropdown-divider">
                                                                                    </li>
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center text-danger direct-delete-btn" href="#">
                                                                                            <span class="me-auto">Delete</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% elif file.file_path %}
                                                                    <div class="message-content">
                                                                        <div class="message-text">
                                                                            {% if user_message.reply %}
                                                                                <blockquote class="blockquote overflow-hidden">
                                                                                    <h6 class="text-reset text-truncate">Reply to</h6>
                                                                                    <p class="small text-truncate">{% for file in user_message.reply.file_message.all %}{{ file.name }}{% endfor %}</p>
                                                                                </blockquote>
                                                                            {% endif %}
                                                                            <div class="row align-items-center gx-4">
                                                                                <div class="col-auto">
                                                                                    <a href="{{ file.file_path.url }}" class="avatar avatar-sm">
                                                                                        <div class="avatar-text bg-white text-primary">
                                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                                                                                        </div>
                                                                                    </a>
                                                                                </div>
                                                                                <div class="col overflow-hidden">
                                                                                    <h6 class="text-truncate text-reset">
                                                                                        <a href="{{ file.file_path.url }}" class="text-reset">{{ file.name }}</a>
                                                                                    </h6>
                                                                                    <ul class="list-inline text-uppercase extra-small opacity-75 mb-0">
                                                                                        <li class="list-inline-item">{{ file.file_path.size|sizefy }}</li>
                                                                                    </ul>
                                                                                </div>
                                                                            </div>
                    
                                                                        </div>
                    
                                                                        <!-- Dropdown -->
                                                                        <div class="message-action">
                                                                            <div class="dropdown">
                                                                                <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                                </a>

                                                                                <ul class="dropdown-menu">
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center direct-reply-btn" href="#">
                                                                                            <span class="me-auto">Reply</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                    <li>
                                                                                        <hr class="dropdown-divider">
                                                                                    </li>
                                                                                    <li>
                                                                                        <a class="dropdown-item d-flex align-items-center text-danger direct-delete-btn" href="#">
                                                                                            <span class="me-auto">Delete</span>
                                                                                            <div class="icon">
                                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                                                            </div>
                                                                                        </a>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% endif %}
                                                            {% endfor %}
                                                        {% endif %}
                                                        {% if user_message.content %}
                                                            <div class="message-content">
                                                                <div class="message-text">
                                                                    {% if user_message.reply %}
                                                                    <blockquote class="blockquote overflow-hidden">
                                                                        <h6 class="text-reset text-truncate">Reply to</h6>
                                                                        <p class="small text-truncate">{{ user_message.reply.content }}</p>
                                                                    </blockquote>
                                                                    {% endif %}
                                                                    <pre style="font-family: var(--bs-body-font-family);font-size: 15px;font-weight: 400;margin-bottom: 0px;"><p class="direct-message-content">{{ user_message.content }}</p></pre>
                                                                </div>

                                                                <!-- Dropdown -->
                                                                <div class="message-action">
                                                                    <div class="dropdown">
                                                                        <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                                        </a>
                                                                        <ul class="dropdown-menu" style="">
                                                                            <li>
                                                                                <a class="dropdown-item d-flex align-items-center direct-reply-btn" href="#">
                                                                                    <span class="me-auto">Reply</span>
                                                                                    <div class="icon">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-corner-up-left"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
                                                                                    </div>
                                                                                </a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    </div>

                                                    <div class="message-footer">
                                                        <span class="extra-small text-muted">{{ user_message.timestamp|date:"h:i A" }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="d-flex flex-column h-100 justify-content-center chat-empty">
                                <div class="text-center mb-6">
                                    <span class="icon icon-xl text-muted">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send">
                                            <line x1="22" y1="2" x2="11" y2="13"></line>
                                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                        </svg>
                                    </span>
                                </div>
                                <p class="text-center text-muted">No messages yet, <br> start the conversation!</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <!-- Chat: Footer -->
                <div class="chat-footer pb-3 pb-lg-7 position-absolute bottom-0 start-0">
                    <!-- Chat: Files -->
                    <div class="dz-preview bg-dark" id="dz-preview-row" data-horizontal-scroll="">
                    </div>
                    <!-- Chat: Files -->

                    <!-- Chat: Form -->
                    <div class="chat-form reverse-rounded-pill bg-dark" data-emoji-form="">
                        <div class="chat-form-hr"></div>
                        <div class="row align-items-center gx-0">
                            <div class="col-auto">
                                <a href="#" class="btn btn-icon btn-link text-body rounded-circle" id="dz-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-paperclip"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                                </a>
                                <form method="POST" id="direct-upload-file">
                                    {% csrf_token %}
                                    <input multiple=True type="file" class="up-hidden-input" tabindex="-1" style="visibility: hidden; position: absolute; top: 0px; left: 0px; height: 0px; width: 0px;">
                                </form>
                            </div>

                            <div class="col">
                                <div class="input-group">
                                    <textarea class="form-control px-0 chat_message" placeholder="Type your message..." rows="1" data-emoji-input="" data-autosize="true"></textarea>

                                    <a href="#" class="input-group-text text-body pe-0" data-emoji-btn="">
                                        <span class="icon icon-lg">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-smile"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
                                        </span>
                                    </a>
                                </div>
                            </div>

                            <div class="col-auto">
                                <button class="btn btn-icon btn-primary rounded-circle ms-5 direct-send-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Chat: Form -->
                </div>
                <!-- Chat: Footer -->
            </div>

        </div>
    </div>

    <!-- User profile -->
    <div class="modal fade" id="modal-user-profile-{{ thread.user2.id }}" tabindex="-1" aria-labelledby="modal-user-profile-{{ thread.user2.id }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-fullscreen-xl-down">
            <div class="modal-content">

                <div class="modal-body py-0">
                    <div class="profile modal-gx-n">
                        <div class="profile-img text-primary rounded-top-xl">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 400 140.74"><defs><style>.cls-2{fill:#fff;opacity:0.1;}</style></defs><g><g><path d="M400,125A1278.49,1278.49,0,0,1,0,125V0H400Z"/><path class="cls-2" d="M361.13,128c.07.83.15,1.65.27,2.46h0Q380.73,128,400,125V87l-1,0a38,38,0,0,0-38,38c0,.86,0,1.71.09,2.55C361.11,127.72,361.12,127.88,361.13,128Z"/><path class="cls-2" d="M12.14,119.53c.07.79.15,1.57.26,2.34v0c.13.84.28,1.66.46,2.48l.07.3c.18.8.39,1.59.62,2.37h0q33.09,4.88,66.36,8,.58-1,1.09-2l.09-.18a36.35,36.35,0,0,0,1.81-4.24l.08-.24q.33-.94.6-1.9l.12-.41a36.26,36.26,0,0,0,.91-4.42c0-.19,0-.37.07-.56q.11-.86.18-1.73c0-.21,0-.42,0-.63,0-.75.08-1.51.08-2.28a36.5,36.5,0,0,0-73,0c0,.83,0,1.64.09,2.45C12.1,119.15,12.12,119.34,12.14,119.53Z"/><circle class="cls-2" cx="94.5" cy="57.5" r="22.5"/><path class="cls-2" d="M276,0a43,43,0,0,0,43,43A43,43,0,0,0,362,0Z"/></g></g></svg>

                            <div class="position-absolute top-0 start-0 p-5">
                                <button type="button" class="btn-close btn-close-white btn-close-arrow opacity-100" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                        </div>

                        <div class="profile-body">
                            <div class="avatar avatar-xl">
                                <img class="avatar-img" src="{{ thread.user2.avatar.url }}" alt="#">

                                <a href="#" class="badge badge-lg badge-circle bg-primary text-white border-outline position-absolute bottom-0 end-0">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                </a>
                            </div>

                            <h4 class="mb-1">{{ thread.user2.user.username }}</h4>
                        </div>
                    </div>

                    <hr class="hr-bold modal-gx-n my-0">

                    <ul class="list-group list-group-flush">
                        {% if thread.user2.country %}
                        <li class="list-group-item">
                            <div class="row align-items-center gx-6">
                                <div class="col">
                                    <h5>Location</h5>
                                    <p>{{ thread.user2.country }}</p>
                                </div>

                                <div class="col-auto">
                                    <div class="btn btn-sm btn-icon btn-dark">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-globe"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if thread.user2 %}
                        <li class="list-group-item">
                            <div class="row align-items-center gx-6">
                                <div class="col">
                                    <h5>E-mail</h5>
                                    <p>{{ thread.user2 }}</p>
                                </div>

                                <div class="col-auto">
                                    <div class="btn btn-sm btn-icon btn-dark">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if thread.user2.phone %}
                        <li class="list-group-item">
                            <div class="row align-items-center gx-6">
                                <div class="col">
                                    <h5>Phone</h5>
                                    <p>+{{ thread.user2.phone }}</p>
                                </div>

                                <div class="col-auto">
                                    <div class="btn btn-sm btn-icon btn-dark">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone-call"><path d="M15.05 5A5 5 0 0 1 19 8.95M15.05 1A9 9 0 0 1 23 8.94m-1 7.98v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                    </ul>

                    <hr class="hr-bold modal-gx-n my-0">

                    <!-- List -->
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <a href="#" class="text-danger">Block User</a>
                        </li>
                    </ul>
                    <!-- List -->
                </div>
                <!-- Modal body -->

            </div>
        </div>
    </div>
    <!-- Chat: Info -->
    <div class="offcanvas offcanvas-end offcanvas-aside offcanvas-more-info" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvas-more-{{ thread.id }}">
        <!-- Offcanvas Header -->
        <div class="offcanvas-header py-4 py-lg-7 border-bottom">
            <a class="icon icon-lg text-muted" href="#" data-bs-dismiss="offcanvas">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg>
            </a>

            <div class="visibility-xl-invisible overflow-hidden text-center">
                <h5 class="text-truncate">{{ thread.user2.user.username }}</h5>
            </div>

            <!-- Dropdown -->
            <div class="dropdown">
                <a class="icon icon-lg text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                </a>

                <ul class="dropdown-menu">
                    <li>
                        <a href="#" class="dropdown-item d-flex align-items-center text-danger">
                            Block
                            <div class="icon ms-auto">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- Offcanvas Header -->

        <!-- Offcanvas Body -->
        <div class="offcanvas-body hide-scrollbar">
            <!-- Avatar -->
            <div class="text-center py-10">
                <div class="row gy-6">
                    <div class="col-12">
                        <div class="avatar avatar-xl mx-auto">
                            <img src="{{ thread.user2.avatar.url }}" alt="#" class="avatar-img">

                            <a href="#" class="badge badge-lg badge-circle bg-primary text-white border-outline position-absolute bottom-0 end-0">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            </a>
                        </div>
                    </div>

                    <div class="col-12">
                        <h4>{{ thread.user2.user.username }}</h4>
                    </div>
                </div>
            </div>
            <!-- Avatar -->

            <!-- Tabs -->
            <ul class="nav nav-pills nav-justified" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="pill" href="#offcanvas-tab-profile" role="tab" aria-controls="offcanvas-tab-profile" aria-selected="true">
                        Profile
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="pill" href="#offcanvas-tab-media" role="tab" aria-controls="offcanvas-tab-media" aria-selected="true">
                        Media
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="pill" href="#offcanvas-tab-files" role="tab" aria-controls="offcanvas-tab-files" aria-selected="false">
                        Files
                    </a>
                </li>
            </ul>
            <!-- Tabs -->

            <!-- Tabs: Content -->
            <div class="tab-content py-2" role="tablist">
                <!-- Profile -->
                <div class="tab-pane fade show active" id="offcanvas-tab-profile" role="tabpanel">

                    <ul class="list-group list-group-flush">
                        {% if thread.user2.country %}
                        <li class="list-group-item">
                            <div class="row align-items-center gx-6">
                                <div class="col">
                                    <h5>Location</h5>
                                    <p>{{ thread.user2.country }}</p>
                                </div>

                                <div class="col-auto">
                                    <div class="btn btn-sm btn-icon btn-dark">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-globe"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if thread.user2 %}
                        <li class="list-group-item">
                            <div class="row align-items-center gx-6">
                                <div class="col">
                                    <h5>E-mail</h5>
                                    <p>{{ thread.user2 }}</p>
                                </div>

                                <div class="col-auto">
                                    <div class="btn btn-sm btn-icon btn-dark">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if thread.user2.phone %}
                        <li class="list-group-item">
                            <div class="row align-items-center gx-6">
                                <div class="col">
                                    <h5>Phone</h5>
                                    <p>+{{ thread.user2.phone }}</p>
                                </div>

                                <div class="col-auto">
                                    <div class="btn btn-sm btn-icon btn-dark">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone-call"><path d="M15.05 5A5 5 0 0 1 19 8.95M15.05 1A9 9 0 0 1 23 8.94m-1 7.98v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                    </ul>

                    <ul class="list-group list-group-flush border-top mt-8">
                        <form id="delete-chat-form" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="thread-id" value="{{ thread.id }}">
                            <input type="hidden" name="delete-chat">
                            
                            <li class="list-group-item">
                                <a href="#" id="delete-chat-link" class="text-danger">Delete Chat</a>
                            </li>
                        </form>                    
                    </ul>
                </div>
                <!-- Profile -->

                <!-- Media -->
                <div class="tab-pane fade" id="offcanvas-tab-media" role="tabpanel">
                    <div class="row row-cols-3 g-3 py-6">
                        {% for user_message in thread.messages.all %}
                            {% for image in user_message.file_message.all %}
                                {% if image.image_path %}
                                    <div class="col">
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#modal-media-preview-{{ image.id }}" data-theme-img-url="{{ image.image_path.url }}">
                                            <img class="img-fluid rounded" src="{{ image.image_path.url }}" alt="">
                                        </a>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>
                <!-- Media -->

                <!-- Files -->
                <div class="tab-pane fade" id="offcanvas-tab-files" role="tabpanel">
                    <ul class="list-group list-group-flush">
                        {% for user_message in thread.messages.all %}
                            {% for file in user_message.file_message.all %}
                                {% if file.file_path %}
                                    <!-- Item -->
                                    <li class="list-group-item">
                                        <div class="row align-items-center gx-5">
                                            <!-- Icons -->
                                            <div class="col-auto">
                                                <div class="avatar-group">
                                                    <a href="#" class="avatar avatar-sm">
                                                        <img src="{{ user_message.sender.avatar.url }}" class="avatar-img" alt="#">
                                                    </a>

                                                    <a href="#" class="avatar avatar-sm">
                                                        <span class="avatar-text bg-primary">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                                        </span>
                                                    </a>
                                                </div>
                                            </div>
                                            <!-- Icons -->

                                            <!-- Text -->
                                            <div class="col overflow-hidden">
                                                <h5 class="text-truncate">
                                                    <a href="#">{{ file.name }}</a>
                                                </h5>
                                            </div>
                                            <!-- Text -->

                                            <!-- Dropdown -->
                                            <div class="col-auto">
                                                <div class="dropdown">
                                                    <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                                    </a>

                                                    <ul class="dropdown-menu">
                                                        <li>
                                                            <a class="dropdown-item d-flex align-items-center" href="{{ file.file_path.url }}">
                                                                Download
                                                                <div class="icon ms-auto">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                                                </div>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <!-- Dropdown -->
                                        </div>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </ul>
                </div>
                <!-- Files -->
            </div>
            <!-- Tabs: Content -->
        </div>
        <!-- Offcanvas Body -->
    </div>

    {% for user_message in thread.messages.all %}
        {% for image in user_message.file_message.all %}
            <div class="modal fade" id="modal-media-preview-{{ image.id }}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-xl modal-dialog-centered modal-fullscreen-xl-down">
                    <div class="modal-content">

                        <!-- Modal: Header -->
                        <div class="modal-header">
                            <button type="button" class="btn-close btn-close-arrow" data-bs-dismiss="modal" aria-label="Close"></button>

                            <div>
                                <!-- Dropdown -->
                                <div class="dropdown">
                                    <a class="icon text-muted" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                    </a>

                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item d-flex align-items-center" href="{{ image.image_path.url }}">
                                                Download
                                                <div class="icon ms-auto">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download-cloud"><polyline points="8 17 12 21 16 17"></polyline><line x1="12" y1="12" x2="12" y2="21"></line><path d="M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29"></path></svg>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <!-- Dropdown -->
                            </div>
                        </div>
                        <!-- Modal: Header -->

                        <!-- Modal: Body -->
                        <div  class="modal-body p-0">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <img class="img-fluid modal-preview-url" src="{{ image.image_path.url }}" alt="#">

                            </div>
                        </div>
                        <!-- Modal: Body -->

                        <!-- Modal: Footer -->
                        <div class="modal-footer">
                            <div class="w-100 text-center">
                                <h6><a href="#">{{ user_message.sender|title }}</a></h6>
                                <p class="small">Today at {{ user_message.timestamp|date:"h:i A"  }}</p>
                            </div>
                        </div>
                        <!-- Modal: Footer -->
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endfor %}
{% endfor %}
{% endblock content %}
